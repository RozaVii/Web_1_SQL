# Web_1_SQL
**Вариант 61**
Предметная область
В интернет-магазине продаются книги. Каждая книга имеет название, написана одним автором, относится к одному жанру, имеет определенную цену. В магазине в наличии есть несколько экземпляров каждой книги.

Покупатель регистрируется на сайте интернет-магазина, задает свое имя и фамилию, электронную почту и город проживания. Он может сформировать один или несколько заказов, для каждого заказа написать какие-то пожелания. Каждый заказ включает одну или несколько книг, каждую книгу можно заказать в нескольких экземплярах. Затем заказ проходит ряд последовательных этапов (операций): оплачивается, упаковывается, передается курьеру или транспортной компании для транспортировки и, наконец, доставляется покупателю. Фиксируется дата каждой операции. Для каждого города известно среднее время доставки книг.

При этом в магазине ведется учет книг, при покупке их количество уменьшается, при поступлении товара увеличивается, при исчерпании количества – оформляется заказ и пр.

**Задание 1**
Для каждого доставленного заказа указать какие книги и в каком количестве были включены в этот заказ. Также для заказа указать город доставки. Столбцы назвать Заказ, Город, Книга, Количество. Информацию отсортировать сначала по номеру заказа, а затем пот названиям книг в алфавитном порядке.

**Задание 2**
Вывести номера заказов и фамилию клиента, который их заказал, общая стоимость которых либо больше 2000, либо меньше 500. Для заказов указать их стоимость. Столбцы назвать Заказ, Клиент, Стоимость. Информацию отсортировать сначала по убыванию стоимости, затем по фамилиям клиентов алфавитном порядке.

**Задание 3**
Найти самые популярные жанры (книги, относящиеся к которым чаще всего заказывали покупатели) и вывести все книги, которые относятся к этим жанрам.

**Задание 4**
В магазине производится переоценка книг. Новая цена определяется по следющему алгоритму:

если общее количество проданных экземпляров этой книги, превышает среднее количество экземпляров книг во всех заказах, то цену увеличить на 10%
для остальных книг снизить цену на 5%.
Обновить цены всех книг по указанному алгоритму.
**Задание 5**
Подготовить отчет для анализа остатков книг на складе. В отчет включить отсортированную по количеству экземпляров информацию о книгах (автор, название, количество). А также ранг каждой книги, ее совокупное распределение и процентный ранг книги (в процентах). Информацию в таблице пронумеровать. Если название книги превышает 15 символов, то обрезать его до 12 символов и добавить  многоточие "...". Столбцы назвать Nпп, Автор, Книга, Кол-во, Ранг, Распределение и Ранг,%. Последние два столбца округлить до двух знаков после запятой.

Примечание. Для решения задания № 5 использовать оконные функции.
